<div class="container">
  <h2>Painel de Tarefas</h2>
  <div class="kanban row">

    <!-- Em atraso -->
    <div id="atraso" class="col-md-3 kanban-col"
         cdkDropList
         [cdkDropListData]="tarefasEmAtraso"
         [cdkDropListConnectedTo]="['afazer','emandamento','concluidas']"
         (cdkDropListDropped)="drop($event)">
      <h4>⏰ Em atraso</h4>
      <div class="kanban-cards">
        <div class="card mb-2" *ngFor="let tarefa of tarefasEmAtraso" 
             cdkDrag
             [cdkDragData]="tarefa"
             (click)="abrirModal(tarefa)">
          <div class="card-header">
            <h5>{{ tarefa.titulo }}</h5>
            <span class="status-badge {{ tarefa.flag | lowercase }}">{{ tarefa.flag }}</span>
          </div>
          <p><strong>Vencimento:</strong> {{ tarefa.dataVencimento | date:'dd/MM/yyyy' }} às {{ tarefa.horaVencimento }}</p>
          <p><strong>Descrição:</strong> {{ tarefa.descricao }}</p>
          <p><strong>Status:</strong> Em Atraso</p>
        </div>
      </div>
    </div>

    <!-- A fazer -->
    <div id="afazer" class="col-md-3 kanban-col"
         cdkDropList
         [cdkDropListData]="tarefasAFazer"
         [cdkDropListConnectedTo]="['atraso','emandamento','concluidas']"
         (cdkDropListDropped)="drop($event)">
      <h4>📝 A fazer</h4>
      <div class="kanban-cards">
        <div class="card mb-2" *ngFor="let tarefa of tarefasAFazer" 
             cdkDrag
             [cdkDragData]="tarefa"
             (click)="abrirModal(tarefa)">
          <div class="card-header">
            <h5>{{ tarefa.titulo }}</h5>
            <span class="status-badge {{ tarefa.flag | lowercase }}">{{ tarefa.flag }}</span>
          </div>
          <p><strong>Vencimento:</strong> {{ tarefa.dataVencimento | date:'dd/MM/yyyy' }} às {{ tarefa.horaVencimento }}</p>
          <p><strong>Descrição:</strong> {{ tarefa.descricao }}</p>
          <p><strong>Status:</strong> A Fazer</p>
        </div>
      </div>
    </div>

    <!-- Em andamento -->
    <div id="emandamento" class="col-md-3 kanban-col"
         cdkDropList
         [cdkDropListData]="tarefasEmAndamento"
         [cdkDropListConnectedTo]="['atraso','afazer','concluidas']"
         (cdkDropListDropped)="drop($event)">
      <h4>⚙️ Em andamento</h4>
      <div class="kanban-cards">
        <div class="card mb-2" *ngFor="let tarefa of tarefasEmAndamento" 
             cdkDrag
             [cdkDragData]="tarefa"
             (click)="abrirModal(tarefa)">
          <div class="card-header">
            <h5>{{ tarefa.titulo }}</h5>
            <span class="status-badge {{ tarefa.flag | lowercase }}">{{ tarefa.flag }}</span>
          </div>
          <p><strong>Vencimento:</strong> {{ tarefa.dataVencimento | date:'dd/MM/yyyy' }} às {{ tarefa.horaVencimento }}</p>
          <p><strong>Descrição:</strong> {{ tarefa.descricao }}</p>
          <p><strong>Status:</strong> Em Andamento</p>
        </div>
      </div>
    </div>

    <!-- Concluídas -->
    <div id="concluidas" class="col-md-3 kanban-col concluidas"
         cdkDropList
         [cdkDropListData]="tarefasConcluidas"
         [cdkDropListConnectedTo]="['atraso','afazer','emandamento']"
         (cdkDropListDropped)="drop($event)">
      <h4>✅ Concluídas</h4>
      <div class="kanban-cards concluidas-cards">
        <div class="card mb-2" *ngFor="let tarefa of tarefasConcluidas" 
             cdkDrag
             [cdkDragData]="tarefa"
             (click)="abrirModal(tarefa)">
          <div class="card-header">
            <h5>{{ tarefa.titulo }}</h5>
            <span *ngIf="tarefa.flag !== Flag.Concluido" class="status-badge {{ tarefa.flag | lowercase }}">
              {{ tarefa.flag }}
            </span>
          </div>
          <p><strong>Vencimento:</strong> {{ tarefa.dataVencimento | date:'dd/MM/yyyy' }} às {{ tarefa.horaVencimento }}</p>
          <p><strong>Descrição:</strong> {{ tarefa.descricao }}</p>
          <p><strong>Status:</strong> Concluído</p>
        </div>
      </div>
    </div>

  </div>

  <!-- Botão flutuante de criar tarefa -->
  <button class="btn-flutuante btn btn-primary" (click)="abrirCriarModal()">
    <i class="fas fa-plus"></i>
  </button>

  <!-- Modal de visualizar tarefa -->
  <app-vertarefas
    *ngIf="tarefaSelecionada"
    [tarefa]="tarefaSelecionada"
    (fechar)="fecharModal()"
    (editar)="abrirCriarModal($event)"
    (excluir)="removerTarefa($event)"
    (concluir)="tarefaConcluida($event)">
  </app-vertarefas>

  <!-- Modal de criar/editar tarefa -->
  <app-criartarefas
    *ngIf="exibirCriarTarefa"
    [tarefa]="tarefaParaEdicao"
    (salvar)="tarefaCriadaOuAtualizada($event)"
    (fechar)="exibirCriarTarefa=false">
  </app-criartarefas>

</div>
