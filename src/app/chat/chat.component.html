<!-- chat.component.html -->
<div class="chat-app">
  <aside class="sidebar">
    <div class="sidebar-top">
      <input class="search" placeholder="Buscar conversas..." [(ngModel)]="filter" (input)="applyFilter()" />
    </div>
 
    <div class="sidebar-section">
      <div class="section-title">üìå FIXADO</div>
      <div *ngFor="let c of pinnedConversations" class="conv-item" [class.active]="selected?.id===c.id" (click)="selectConversation(c)">
        <div class="conv-left">
          <div class="avatar">
            <ng-container [ngSwitch]="c.icone">
              <svg *ngSwitchCase="'robot'" class="icon" viewBox="0 0 24 24"><path d="M7 7h10v6H7z" fill="none"/><path d="M9 11h6v2H9z"/><path d="M12 3v2"/><path d="M7 7v-1a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1"/></svg>
              <svg *ngSwitchCase="'group'" class="icon" viewBox="0 0 24 24"><path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3"/><path d="M8 11c1.66 0 3-1.34 3-3S9.66 5 8 5"/><path d="M4 17c0-2.21 3.58-4 8-4s8 1.79 8 4v2H4v-2z"/></svg>
              <svg *ngSwitchDefault class="icon" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="M2 20c1-4 6-6 10-6s9 2 10 6"/></svg>
            </ng-container>
          </div>
        </div>
 
        <div class="conv-right">
          <div class="conv-name">{{ c.nome }}</div>
          <div class="conv-last">{{ getLastSnippet(c) }}</div>
        </div>
 
        <div class="conv-actions">
          <button class="icon-btn" (click)="openEditModal(c); $event.stopPropagation()" title="Editar">
            <!-- pencil -->
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/><path d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
          </button>
        </div>
      </div>
    </div>
 
    <div class="sidebar-section">
      <div class="section-title">üì± CONVERSAS</div>
      <div *ngFor="let c of conversationsFiltered" class="conv-item" [class.active]="selected?.id===c.id" (click)="selectConversation(c)">
        <div class="conv-left">
          <div class="avatar">
            <ng-container [ngSwitch]="c.icone">
              <svg *ngSwitchCase="'robot'" class="icon" viewBox="0 0 24 24"><path d="M7 7h10v6H7z" fill="none"/><path d="M9 11h6v2H9z"/><path d="M12 3v2"/><path d="M7 7v-1a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1"/></svg>
              <svg *ngSwitchCase="'group'" class="icon" viewBox="0 0 24 24"><path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3"/><path d="M8 11c1.66 0 3-1.34 3-3S9.66 5 8 5"/><path d="M4 17c0-2.21 3.58-4 8-4s8 1.79 8 4v2H4v-2z"/></svg>
              <svg *ngSwitchDefault class="icon" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="M2 20c1-4 6-6 10-6s9 2 10 6"/></svg>
            </ng-container>
          </div>
        </div>
 
        <div class="conv-right">
          <div class="conv-name">{{ c.nome }}</div>
          <div class="conv-last">{{ getLastSnippet(c) }}</div>
        </div>
 
        <div class="conv-actions">
          <button class="icon-btn" (click)="openEditModal(c); $event.stopPropagation()" title="Editar">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/><path d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
          </button>
        </div>
      </div>
    </div>
 
    <button class="new-conv" (click)="createConversation()">+ Nova conversa</button>
 
 
  </aside>
 
  <main class="chat-area" *ngIf="selected">
    <header class="chat-header">
      <div class="header-left">
        <div class="header-avatar">
          <ng-container [ngSwitch]="selected.icone">
            <svg *ngSwitchCase="'robot'" class="icon" viewBox="0 0 24 24"><path d="M7 7h10v6H7z" fill="none"/><path d="M9 11h6v2H9z"/><path d="M12 3v2"/><path d="M7 7v-1a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1"/></svg>
            <svg *ngSwitchCase="'group'" class="icon" viewBox="0 0 24 24"><path d="M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3"/><path d="M8 11c1.66 0 3-1.34 3-3S9.66 5 8 5"/><path d="M4 17c0-2.21 3.58-4 8-4s8 1.79 8 4v2H4v-2z"/></svg>
            <svg *ngSwitchDefault class="icon" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10z"/><path d="M2 20c1-4 6-6 10-6s9 2 10 6"/></svg>
          </ng-container>
        </div>
 
        <div class="header-info">
          <div class="name">{{ selected.nome }}</div>
          <div class="sub">{{ selected.tipo === 'bot' ? 'Assistente Virtual' : (selected.tipo==='grupo'? 'Grupo' : 'Contato') }}</div>
        </div>
      </div>
 
      <div class="header-right">
        <button class="icon-btn" (click)="toggleFix(selected)" [title]="selected.fixado ? 'Desfixar' : 'Fixar'">
          <svg *ngIf="!selected.fixado" class="icon" viewBox="0 0 24 24"><path d="M6 2l6 6"/></svg>
          <svg *ngIf="selected.fixado" class="icon" viewBox="0 0 24 24"><path d="M6 2l6 6"/></svg>
        </button>
 
        <button class="icon-btn" (click)="openEditModal(selected)" title="Editar contato">
          <svg class="icon" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/><path d="M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
        </button>
 
        <button class="icon-btn danger" (click)="deleteConversation(selected)" title="Excluir conversa">
          <svg class="icon" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
        </button>
      </div>
    </header>
 
    <section class="messages" #messagesBox>
      <div *ngFor="let m of selected.mensagens" class="message" [ngClass]="{'me': isMe(m),'bot': m.autor==='bot'}">
        <div class="msg-author" *ngIf="!isMe(m) && m.autor!=='bot'">{{ m.autor }}</div>
        <div class="msg-bubble">
          <div class="msg-text">{{ m.texto }}</div>
          <div class="msg-time">{{ formatTime(m.timestamp) }}</div>
        </div>
      </div>
 
      <div class="typing" *ngIf="typing && (selected.tipo==='bot')">
        <div class="typing-icon">
          <svg class="icon" viewBox="0 0 24 24"><path d="M7 7h10v6H7z" fill="none"/><path d="M9 11h6v2H9z"/></svg>
        </div>
        <div class="dots">digitando<span>.</span><span>.</span><span>.</span></div>
      </div>
    </section>
 
    <footer class="chat-input">
      <button class="icon-btn attach" title="Anexar">
        <svg class="icon" viewBox="0 0 24 24"><path d="M21.44 11.05l-8.49 8.49a5 5 0 0 1-7.07 0 5 5 0 0 1 0-7.07l8.49-8.49a3 3 0 0 1 4.24 4.24L10.1 18.3"/></svg>
      </button>
 
      <input type="text" placeholder="Digite uma mensagem..." [(ngModel)]="draft" (keydown.enter)="sendMessage()" />
 
      <button class="send-btn" (click)="sendMessage()" title="Enviar">
        <svg class="icon" viewBox="0 0 24 24"><path d="M22 2L11 13"/></svg>
      </button>
    </footer>
  </main>
 
  <main class="chat-empty" *ngIf="!selected">
    <div class="empty">Selecione uma conversa na sidebar</div>
  </main>
</div>
 
<!-- Edit modal -->
<div class="modal-backdrop" *ngIf="editModalOpen">
  <div class="modal">
    <h3>Editar contato</h3>
    <label>Nome</label>
    <input [(ngModel)]="editModel.nome" />
    <label>√çcone</label>
    <select [(ngModel)]="editModel.icone">
      <option value="user">Usu√°rio</option>
      <option value="robot">Assistente</option>
      <option value="group">Grupo</option>
    </select>
 
    <div class="modal-actions">
      <button (click)="saveEdit()">Salvar</button>
      <button class="danger" (click)="closeEditModal()">Cancelar</button>
    </div>
  </div>
</div>
 